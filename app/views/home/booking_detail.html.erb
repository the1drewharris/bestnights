<div id="wrapper" class="bookingdetail">
	<div id="eyebrow">
		<%= render :partial => "common/home_nav_tab" %>
	</div>
	
	<header>
		<div class="headdetails">
			<span class="starrating">
				<% @hotel.star.to_i.times do %>
		  		&#10029;
		  	<% end %>
		  </span><br>
		</div>
		<h1 class="prop-title"><%= @hotel.name %></h1><br/>
		<address><%= @hotel.address1 %></address>
	</header>	
	
	<section id="gallery">
		<div class="album" data-jgallery-album-title="Hotel Name">
			<% @hotel.hotel_photos.each do |photo| %>
				<a href=<%= photo.picture.url %>><img src=<%= photo.picture.url %> size="75x75" alt=""  data-jgallery-bg-color="#d1d2c3" data-jgallery-text-color="#272727" /></a>
			<% end %>			
		</div>
	</section>
	
	<a href="#bookingoptions" class="button5" onclick="scrollToAnchor('book');" id="booking_hotel">Book Now</a>
	<section class="description">
		<p><%= @hotel.description %></p>
		<div class="details">
			<h6>Room Features</h6>
			<p>
				<% @room_attrs.each do |room_attr| %>
					<%= room_attr.first + ', ' %>
				<% end %>
			</p>
			<h6>Hotel Features</h6>
			<p>
				<% @hotel.hotel_attributes.each do |ha| %>
				  <%= ha.attr + ', ' %>
				<% end %>
			</p>
			<h6>Description</h6>
			<p><%= @hotel.description %></p>
			<h6>Policy:</h6> 
			<p><%= @hotel.policy.blank? ? "" : hotel.policy.titleize %></p>		
		</div>
	</section>
	
	<div id="searchdates">
		<h4 class="check_availability" style="cursor: pointer;">Check Availability</h4>
		<form method="get" action="/hotels/search" accept-charset="UTF-8">
			<input type="hidden" id="checkindate" name="date[checkin]" value=<%= session[:checkin] %> >
			<input type="hidden" id="checkoutdate" name="date[checkout]" value=<%= session[:checkout] %> >
			<input type="hidden" id="roomtype" name="roomtype">
			<div id="checkin"></div>
			<div id="checkout"></div>
			<!--<div id="checkin"><span>Check in</span><span>Wednesday, 26th<br>February 2014</span></div>-->
			<!--<div id="checkout"><span>Check out</span><span>Friday, 28th<br>February 2014</span></div>-->
			<div id="jrange" class="dates">
				<input>
				<div></div>
			</div>
			<ul id="roomtypes">
				<li value="1"><a>Single Room</a></li>
				<li value="2"><a>Double Room</a></li>
				<li value="3"><a>Groups</a></li>
			</ul>
			<div id="groupopts">
				<label for="roomqty">Number of Rooms</label>
				<input name="group[roomqty]" id="roomqty" type="number" min="1" value="1">
				<ul>
					<li>
						<h5>Room 1</h5>
						<ul>
							<li>
								<label>Adults</label>
								<input name="group[beds][1][adultqty]" type="number" min="0" value="1">
							</li>
							<li>
								<label>Children</label>
								<input name="group[beds][1][childqty]" type="number" min="0" value="0">
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</form>
	</div>
	
	<h5 id="available_notification"></h5>	
	<div id="bookingoptions">
		<table>
			<tr>
				<th scope="col">Room Type</th>
				<th scope="col">Conditions</th>
				<th scope="col">Adult</th>
				<th scope="col">Max</th>
				<th scope="col">BestNights.com Price</th>
				<th scope="col">Number of Rooms</th>
				<th scope="col">Reservation</th>
			</tr>
						
			<form action="/checkout" method="post">
				<% @hotel.rooms.each do |room| %>
					<% @statuses = RoomStatus.where("room_type_id=? AND hotel_id=?",room.room_type.id, @hotel.id) %>
					<% @statuses.each do |status| %>
						<% if !status.blank? && ((status.from_date..status.to_date).cover?(Date.today)) %>
							<tr>								
								<td><%= room.room_sub_type.name %></td>
								<td>
									<div class="room-available type">
										<table class="data-tbl">
											<tr>
												<td>
												<% room.room_attributes.each do |ra| %>
												  <%= ra.attr + ', ' %>
												<% end %>	
											</td>
											</tr>
										</table>
									</div>
								</td>
								<td></td>
								<td class="room_available">
								<% @availables = RoomAvailable.where("room_sub_type_id=? AND hotel_id=?",room.room_sub_type_id, @hotel.id ) %>
								<div class="room-available max">
									<table class="data-tbl">
										<tr>
										<% @availables.each do |available| %>
											<% if !available.blank? %>
													<% (session[:checkout].to_date - session[:checkin].to_date).to_i.times do |day| %>
														<% if (available.from_date..available.to_date).cover?(session[:checkin].to_date.advance(days: day)) %>	
																<td>
																<span class="data-tbl-date">29/8/14</span>
																<span><%= available.number %></span>
																</td>														
														<% end %>
													<% end %>										
											<% end %>
										<% end %>
										</tr>
									</table>
								</div>
							</td>

							<td class="price">
								<div class="room-available">
									<table class="data-tbl">	
										<tr>
										<% @rates = RoomRate.where("room_sub_type_id=? AND hotel_id=?", room.room_sub_type_id, @hotel.id) %>
										<% unless @rates.empty? %>
											<% @rates.each do |rate| %>
												<% if !rate.blank? %>											
													<% (session[:checkout].to_date - session[:checkin].to_date).to_i.times do |day| %>
														<% if (rate.from_date..rate.to_date).cover?(session[:checkin].to_date.advance(days: day)) %>
																<%= session[:rate] = rate.price %>
																<td>	
																	<span class="data-tbl-date">29-08-2014</span>
																	$<%= rate.price %>
																</td>
															<% end %>
														<% end %>											
													<% end %>
												<% end %>
										<% else %>									
												<sup>$</sup>0.00<br>									
										<% end %>
										<tr>
									</table>
								</div>
							</td>

									<td class="room_number vertical-m"><% @free.each do |fr| %>
										<% if fr.has_key?(room.room_type.id) %>
											<% if fr[room.room_type.id] != 0 %>
												<input type="number" min="0" max=<%= room.available_max(@from_date, @to_date) %> value="" name="number[<%= room.id %>]" id="room_number">
											<% end %>
										<% end %>
									<% end %>
								</td>
								<td>
									<%  @availables.each do |available| %>
										<% if !available.blank? %>
											<% if available.number > 0 %>
												<% @flag = 1 %>
											<% else %>
												<% @flag = 1 %>
											<% end %>
										<% end %>
									<% end %>
									<% if @flag == 1%>
										<%= link_to "Book Now", checkout_path(:hotel_id => @hotel.id, :room_type_id => room.room_type.id) , class: "link_style", id: "link_style" %>
									<% else %>
										<p class="red">Sold Out</p>
									<% end %>
								</td>
							</tr>
						<% end %>
					<% end %>
				<% end %>			
			</form>
		</table>
	<!-- </form> -->
	</div>
	
	<%= render :partial => "common/home_footer" %>
	
</div>

<script>
	var kept_prv = (new Date("<%= session[:checkin] %>")).getTime(); // kept date
	var kept_cur = (new Date("<%= session[:checkout] %>")).getTime(); // kept date
	var kept_roomtype = "<%= session[:roomtype] %>";
	var kept_group = gon.group;
</script>

<script type="text/javascript">
 //room_number
 $(".link_style").click(function(e){
 	e.preventDefault();
 	var room_needed = $(this).parent().siblings(".room_number").children("#room_number").val();
 	var room_avail = parseInt($(this).parent().siblings(".room_available").children(".room-available").children(".data-tbl").children("tbody").children("tr").children("td").children(".data-tbl-date").siblings("span").html());
 	if (room_needed <= room_avail && room_needed != '') {
 		//var room_available = parseInt($(this).parent().siblings(".room_available").html()) - room_needed;
 		link = $(this).attr('href');
 		link = link + '&room_number='+room_needed + '&total_room=' + room_avail;
 		window.location.href = link;
 		return true;
 	}
 	else if (room_needed > 0) {
 		alert(room_needed + " " + "rooms are not available");
 		return false;
 	}
 	else {
 		return false;
 	}

 })
</script>
