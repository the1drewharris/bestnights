<% content_for :title, "BestNights.com - Edit Hotel" %>

<header>
	<h1>Edit Hotel</h1>
</header>

<div id="container-main">
	<%= form_for @hotel, :html => {:multipart => true} do |f| %>
		<fieldset>
		  <ul>
		  	<li>
		  		<%= f.label 'Hotel Name*' %>
		  		<%= f.text_field :name %>
		  	</li>		  	
		  	<li>
		  		<%= f.label "Address*" %>
		  		<%= f.text_field :address1 %>
		  	</li>
		  	<li>
		  		<%= f.label "City*" %>
		  		<%= f.text_field :city %>
		  	</li>
		  	<li class="state">
		  		<%= f.label "State/Province*" %>
		  		<%= f.select :state_id, options_for_select(@hotel.country.states.map{|s|[s.state_province, s.id]}, @hotel.state.id) %>
		  	</li>
		  	<li class="country">
		  		<%= f.label "Country" %>
		  		<%= f.select :country_id, options_for_select(Country.all.map{|s|[s.country, s.id]}, @hotel.country_id) %>
		  	</li>
		  	<li>
		  		<%= f.label "Zip/Postal Code*" %>
		  		<%= f.text_field :zip %>
		  	</li>		  	
		  	<li>
					<label for="client_comm">Preferred Communication</label>
					<select id="client_comm" name="hotel[email_or_fax]">
						<optgroup label="Preferred Communication">
							<option value="fax" <%= "selected" if @hotel.email_or_fax == "fax" %>>Fax</option>
							<option value="email" <%= "selected" if @hotel.email_or_fax == "email" %>>Email</option>
						</optgroup>
					</select>
				</li>
				<li>
		  		<%= f.label :email %>
		  		<%= f.text_field :email %>
		  	</li>
		  	<li>
		  		<%= f.label :fax %>
		  		<%= f.text_field :fax %>
		  	</li>
				<% if current_user.admin? %>
		  		<li>
			  		<%= f.label "Manager*" %>
			  		<%= f.select :user_id, options_for_select(User.all.map{|s|[s.email, s.id]}, @hotel.user.id) %>
			  	</li>
			  <% end %>
		  </ul>
		</fieldset>	
		<fieldset>
			<ul>
				<li>
					<label for="client_star_rating">Star Rating</label>
					<select id="client_star_rating" name="hotel[star]">
						<optgroup label="Star Rating">
							<option value="1" <%= "selected" if @hotel.star == "1" %> >&#10029;</option>
							<option value="2" <%= "selected" if @hotel.star == "2" %> >&#10029;&#10029;</option>
							<option value="3" <%= "selected" if @hotel.star == "3" %> >&#10029;&#10029;&#10029;</option>
							<option value="4" <%= "selected" if @hotel.star == "4" %> >&#10029;&#10029;&#10029;&#10029;</option>
							<option value="5" <%= "selected" if @hotel.star == "5" %> >&#10029;&#10029;&#10029;&#10029;&#10029;</option>
						</optgroup>
					</select>
				</li>
				<li>
		  		<%= f.label :status %>
					<select id="client_comm" name="hotel[status]">
						<% ["active", "non-active", "non-viewable", "inactive"].each do |status| %>
						  <option value=<%= status %> <%= "selected" if @hotel.status == status %> <%= "disabled" if current_user.manager? %> ><%= status %></option>
						<% end %>
					</select>
				</li> 
				
				<% if current_user.admin? %>
					<li>
						<label><%= @hotel.tax1_label%></label>
						<%= f.text_field :tax1 %>
					</li>
				<% elsif current_user.manager? %>
					<li>
						<%= f.label :tax1_label %>
						<%= f.text_field :tax1_label %>
					</li>
					<li>
						<%= f.label :tax1 %>
						<%= f.text_field :tax1 %>
					</li>
				<% end %>
				
		  	<% if current_user.admin? %>
					<li>
						<label><%= @hotel.tax2_label%></label>
						<%= f.text_field :tax2 %>
					</li>
				<% elsif current_user.manager? %>
					<li>
						<%= f.label :tax2_label %>
						<%= f.text_field :tax2_label %>
					</li>
					<li>
						<%= f.label :tax2 %>
						<%= f.text_field :tax2 %>
					</li>
				<% end %>
				
		  	<% if current_user.admin? %>
					<li>
						<label><%= @hotel.tax3_label%></label>
						<%= f.text_field :tax3 %>
					</li>
				<% elsif current_user.manager? %>
					<li>
						<%= f.label :tax3_label %>
						<%= f.text_field :tax3_label %>
					</li>
					<li>
						<%= f.label :tax3 %>
						<%= f.text_field :tax3 %>
					</li>
				<% end %>
				
		  	<% if current_user.admin? %>
					<li>
						<label><%= @hotel.tax4_label%></label>
						<%= f.text_field :tax4 %>
					</li>
				<% elsif current_user.manager? %>
					<li>
						<%= f.label :tax4_label %>
						<%= f.text_field :tax4_label %>
					</li>
					<li>
						<%= f.label :tax4 %>
						<%= f.text_field :tax4 %>
					</li>
				<% end %>
				
				<li>
		  		<%= f.label :description %>
		  		<%= f.text_area :description %>
		  	</li>
		  	<li>
		  		<%= f.label "Comission rate" %>
		  		<%= f.text_field :comission_rate, :value => @hotel.comission_rate,  :disabled => current_user.manager? %>
		  	</li>
		  	<li>
		  		<%= f.label :card %>
		  		<%= f.select :card_id, options_for_select(Card.all.map{|s|[s.card_number, s.id]}) %>
		  	</li>
		  	<li>
		  		<%= f.label :description %>
		  		<%= f.text_area :description %>
		  	</li>
				<li>							
					<label for="client_photos">Photos</label>
					<div class="dropzone" id="hotel-dropzone" />
				</li>
				<li>
					<span class="formLabel">Attributes</span>
					<div class="checklist">
						<ul>
							<% @hotel_attributes.each do |attr| %>
								<li>
									<input name="client[attributes][<%= attr.id %>]" type="checkbox" <%= "checked" if attr.hotels.include?(@hotel) %>>
									<label for="client[attributes]"><%= attr.attr %></label>
								</li>
							<% end %>
						</ul>
					</div>
				</li>
		  </ul>	
		</fieldset>
		<fieldset class="formactions">
			<%= f.submit %>
		</fieldset>
	<% end %>
</div>

<script>
	$(document).ready(function(){		
		console.log('step1');	
		Dropzone.options.hotelDropzone = {
			url: "/hotel_photos/<%= @hotel.id %>",
			addRemoveLinks: true,
			dictRemoveFileConfirmation: "Are you sure you want to remove this file?",
			paramName: "picture",
			success: function(file, response){
				file.id = response.id
			},
			init: function () {
				console.log('step2');
				<% @photos.each do |photo| %>
					var mockFile = {id: "<%= photo.id %>", name: "<%= photo.picture_file_name %>", size: "<%= photo.picture_file_size %>", type: "<%= photo.picture_content_type %>" };
					this.options.addedfile.call(this, mockFile);
					this.options.thumbnail.call(this, mockFile, "<%= photo.picture.url %>");
				<% end %>    
      },
      removedfile: function(file) {
				$.ajax({
					type: 'DELETE',
					url: "/hotel_photos",
					data: { id: file.id, status: file.status},
					dataType: 'json'
					});
					var _ref;
					return (_ref = file.previewElement) != null ? _ref.parentNode.removeChild(file.previewElement) : void 0; 
      
			}		 
		}
	});
	
</script>